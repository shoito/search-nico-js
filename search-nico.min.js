// search-nico-js v0.1.1
// License: MIT
"use strict";if("undefined"==typeof window)var Promise=Promise||require("promise"),XMLHttpRequest=XMLHttpRequest||require("xmlhttprequest").XMLHttpRequest;(function(){function a(a){var b={200:{status:200,text:"OK"},300:{status:400,text:"Bad Request"},101:{status:503,text:"Service Unavailable"},1001:{status:504,text:"Gateway Timeout"}};return b[a]||{status:500,text:"Internal Server Error"}}var b=function(){var a={};return a.BASE_URL="http://api.search.nicovideo.jp",a.post=function(b,c,d){return new Promise(function(e,f){var g=new XMLHttpRequest;g.onload=function(){if(200===g.status){var a=d(g.responseText);200===a.status?e(a):f({status:a.status,error:a.statusText,error_description:"An error has occurred while requesting api"})}else f({status:g.status,error:g.statusText,error_description:"An error has occurred while requesting api"})},g.onerror=f,g.open("POST",a.BASE_URL+b),g.timeout=c.timeout,g.send(JSON.stringify(c))})},a}(),c=function(){function c(a){if(a=a||{},"undefined"==typeof a.issuer||"undefined"==typeof a.reason)throw new Error("issuer and reason parameters is required.");e.timeout=a.timeout||3e3,e.issuer=a.issuer,e.reason=a.reason}function d(b){var c={};return c.status=a(200).status,b.split("\n").forEach(function(b){if(""!==b){var d=JSON.parse(b);if("stats"===d.type&&d.values)c.hits=d.values[0].total;else if("hits"===d.type&&d.values)c.values=d.values.map(function(a){return delete a._rowid,a});else if(d.errid){var e=a(d.errid);c.status=e.status,c.statusText=e.text}}}),"undefined"==typeof c.hits&&(c.hits=0,c.values=[]),c}var e={query:"keyword",service:["video"],search:["title"],join:["cmsid"],filters:[],from:0,size:10,sort_by:"view_counter"};return c.prototype.equalFilter=function(a,b){return{type:"equal",field:a,value:b}},c.prototype.rangeFilter=function(a,b,c,d,e){var f={type:"range",field:a,include_upper:!0,include_lower:!0};return"undefined"!=typeof b&&(f.from=b),"undefined"!=typeof c&&(f.to=c),"undefined"!=typeof d&&(f.include_upper=d),"undefined"!=typeof e&&(f.include_lower=e),f},c.prototype.service=function(a){return e.service=[a],this},c.prototype.keyword=function(a){return e.query=a,this},c.prototype.target=function(a){return e.search=a,this},c.prototype.filter=function(a){return e.filters=a,this},c.prototype.sort=function(a,b){return e.sort_by=a,e.order=b||"desc",this},c.prototype.select=function(a){return e.join=a,this},c.prototype.from=function(a){return e.from=a,this},c.prototype.size=function(a){return e.size=a,this},c.prototype.fetch=function(){return b.post("/api/",e,d)},c}(),d=function(){function c(a){if(a=a||{},"undefined"==typeof a.issuer||"undefined"==typeof a.reason)throw new Error("issuer and reason parameters is required.");e.timeout=a.timeout||3e3,e.issuer=a.issuer,e.reason=a.reason}function d(b){var c={};return c.status=a(200).status,b.split("\n").forEach(function(b){if(""!==b){var d=JSON.parse(b);if("tags"===d.type&&d.values)c.values=d.values.map(function(a){return a.tag});else if(d.errid){var e=a(d.errid);c.status=e.status,c.statusText=e.text}}}),"undefined"==typeof c.values&&(c.values=[]),c}var e={query:"keyword",service:["video"],from:0,size:10};return c.prototype.service=function(a){return e.service=["tag_"+a],this},c.prototype.keyword=function(a){return e.query=a,this},c.prototype.from=function(a){return e.from=a,this},c.prototype.size=function(a){return e.size=a,this},c.prototype.fetch=function(){return b.post("/api/tag/",e,d)},c}(),e={};e.contents=function(a){return new c(a)},e.tags=function(a){return new d(a)},"undefined"!=typeof module?module.exports=e:this.SearchNico=e}).call(this);